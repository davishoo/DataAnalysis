-- The below is performed on database 'hami'

-- add primary key
ALTER TABLE public.hotel
    ADD PRIMARY KEY (hotel_id)
;

-- add constraint 'unique'
ALTER TABLE public.hotel
    ADD CONSTRAINT uni_hotelname_eng UNIQUE (hotel_name)
;

ALTER TABLE public.hotel
    ADD CONSTRAINT uni_hotelname_chn UNIQUE (酒店名称)
;

ALTER TABLE public.hotel
    ADD CONSTRAINT uni_address UNIQUE (详细地址)
;


-- add foreign key
ALTER TABLE public.hotel_contacts
    ADD CONSTRAINT fk_hotel_id FOREIGN KEY (hotel_id)
    REFERENCES public.hotel (hotel_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


-- set columns NOT NULL
ALTER TABLE public.hotel
    ALTER COLUMN "酒店名称" SET NOT NULL;

ALTER TABLE public.hotel
    ALTER COLUMN hotel_name SET NOT NULL;

ALTER TABLE public.hotel
    ALTER COLUMN "城市" SET NOT NULL;

ALTER TABLE public.hotel
    ALTER COLUMN "酒店位置" SET NOT NULL;

ALTER TABLE public.hotel
    ALTER COLUMN "详细地址" SET NOT NULL;

-- add and del constraint
ALTER TABLE public.hotel_contacts
    ADD CONSTRAINT uni_composite_key UNIQUE (hotel_name, "酒店名称");

ALTER TABLE public.hotel_contacts DROP CONSTRAINT uni_composite_key;

-- prevent inserting duplicated row

ALTER TABLE public.hotel_contacts
    ADD CONSTRAINT no_duplicated_value UNIQUE (
                                            "前台电话", "销售姓名", "销售手机",
                                            "销售座机", "销售微信", "QQ", "销售邮箱");

